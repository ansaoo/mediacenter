{% extends 'base.html.twig' %}

{% block title_page %}Voiture | Overview{% endblock %}

{% block stylesheets %}
    <link href="{{ asset('css/plugins/dataTables/datatables.min.css') }}" rel="stylesheet">
    <!-- Morris -->
    <link href="{{ asset('css/plugins/morris/morris-0.4.3.min.css') }}" rel="stylesheet">

{% endblock %}

{% block page_heading %}
    <div class="col-lg-10">
        <h2>Overview</h2>
        <ol class="breadcrumb">
            <li>
                <a href="#">Home</a>
            </li>
            <li>
                <a>Outils</a>
            </li>
            <li>
                <a>Voiture</a>
            </li>
            <li class="active">
                <strong>Overview</strong>
            </li>
        </ol>
    </div>
    <div class="col-lg-2">

    </div>
{% endblock page_heading %}

{% block body %}
    <div class="row">
        <div class="col-lg-12">
            <div class="ibox float-e-margins">

                <div class="ibox-content">
                    <div class="sk-spinner sk-spinner-wave">
                        <div class="sk-rect1"></div>
                        <div class="sk-rect2"></div>
                        <div class="sk-rect3"></div>
                        <div class="sk-rect4"></div>
                        <div class="sk-rect5"></div>
                    </div>
                    <div class="table-responsive" style="width: 100%">
                        <table class="table table-striped table-bordered table-hover stat">
                        </table>
                    </div>
                    <div id="morris-bar-chart" style="height: 400px"></div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}


{% block javascripts %}
    <script src="{{ asset('js/plugins/dataTables/datatables.min.js') }}"></script>
    <!-- Morris -->
    <script src="{{ asset('js/plugins/morris/raphael-2.1.0.min.js') }}"></script>
    <script src="{{ asset('js/plugins/morris/morris.js') }}"></script>
    <script>
        var languageTrans = {
            "decimal":        "{{ 'dt.decimal'|trans({},'datatable') }}",
            "emptyTable":     "{{ 'dt.emptyTable'|trans({},'datatable') }}",
            "info":           "{{ 'dt.info'|trans({},'datatable') }}",
            "infoEmpty":      "{{ 'dt.infoEmpty'|trans({},'datatable') }}",
            "infoFiltered":   "{{ 'dt.infoFiltered'|trans({},'datatable') }}",
            "infoPostFix":    "{{ 'dt.infoPostFix'|trans({},'datatable') }}",
            "thousands":      "{{ 'dt.thousands'|trans({},'datatable') }}",
            "lengthMenu":     "{{ 'dt.lengthMenu'|trans({},'datatable') }}",
            "loadingRecords": "{{ 'dt.loadingRecords'|trans({},'datatable') }}",
            "processing":     "{{ 'dt.processing'|trans({},'datatable') }}",
            "search":         "{{ 'dt.search'|trans({},'datatable') }}",
            "zeroRecords":    "{{ 'dt.zeroRecords'|trans({},'datatable') }}",
            "paginate": {
                "first":      "{{ 'dt.paginate.first'|trans({},'datatable') }}",
                "last":       "{{ 'dt.paginate.last'|trans({},'datatable') }}",
                "next":       "{{ 'dt.paginate.next'|trans({},'datatable') }}",
                "previous":   "{{ 'dt.paginate.previous'|trans({},'datatable') }}"
            },
            "aria": {
                "sortAscending":  "{{ 'dt.aria.sortAscending'|trans({},'datatable') }}",
                "sortDescending": "{{ 'dt.aria.sortDescending'|trans({},'datatable') }}"
            }
        };

        $(document).ready(function () {
            $('.stat').DataTable({
                ajax: {
                    url: '{{ api_url }}/api.php/elastic/stat',
                    dataSrc: '',
                    error: function (xhr, error, thrown) {
                        toastr.error('Fail');
                        $('.dataTables_empty').text('Error occurred');
                    },
                    beforeSend: function () {
                        $('.ibox-content').toggleClass('sk-loading');
                    },
                    complete: function () {
                        $('.ibox-content').toggleClass('sk-loading');
                    }
                },
                buttons: [],
                columns: [
                    { data: 'key', title: 'Voiture', defaultContent: '' },
                    { data: 'kilometre.value', title: 'Kilometres', defaultContent: '' },
                    { data: 'compteur.value', title: 'Compteur', defaultContent: '' }
                ],
                dom: '<"html5buttons"B>lTfgitp',
                language: languageTrans
            });

            Morris.Bar({
                element: 'morris-bar-chart',
                data: JSON.parse($.ajax({
                    url: '{{ api_url }}/api.php/elastic/histo',
                    dataType: 'json',
                    async: false,
                    error: function () {
                        toastr.error('Error in loading histogram');
                    }
                }).responseText),
                xkey: 'date',
                ykeys: ['celica', 'laguna'],
                labels: ['Celica', 'Laguna'],
                hideHover: 'auto',
                resize: true,
                barColors: ['#1ab394', '#cacaca']
            });
        })

    </script>
{% endblock javascripts %}