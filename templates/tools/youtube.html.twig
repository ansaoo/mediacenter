{% extends 'base.html.twig' %}

{% block title_page %}Youtube-dl{% endblock %}

{% block stylesheets %}
{% endblock %}

{% block page_heading %}
    <div class="col-lg-10">
        <h2>YouTube Downloader</h2>
        <ol class="breadcrumb">
            <li>
                <a href="#">Home</a>
            </li>
            <li>
                <a>Outils</a>
            </li>
            <li class="active">
                <strong>Youtube-dl</strong>
            </li>
        </ol>
    </div>
    <div class="col-lg-2">

    </div>
{% endblock page_heading %}

{% block body %}
    <div class="row">
        <div class="col-lg-12">
            <div class="ibox float-e-margins">

                <div class="ibox-content">
                    {{ form_start(form) }}
                    <div class="input-group m-b">
                        {{ form_widget(form.url, {attr: {placeholder: 'Youtube url'}}) }}
                        <span class="input-group-btn">
                        <i class="fa fa-search"></i>
                            {{ form_widget(form.send) }}
                        </span>
                    </div>
                    {{ form_end(form) }}
                </div>
            </div>
        </div>
    </div>
    {% if title %}
    <div class="row">
        <div class="col-lg-12">
            <div class="ibox float-e-margins">

                <div id="results" class="ibox-content">
                   <h4>{{ title.success }}</h4>
                </div>
            </div>
        </div>
    </div>
    {% endif %}
{% endblock %}


{% block javascripts %}
    <script>
        $(document).ready(function () {
            {% if url %}
            $.ajax({
                url: '{{ (api_url~'/api.php?app=youtubedl')|raw }}',
                dataType: 'json',
                data: {url: '{{ url }}'}
            }).done(function (data) {
                console.log(data);
                $('#results').append(
                    $('<a>',
                    {href: '{{ path('download', {'base': 'ddl', 'filename': ''}) }}'+data, text: 'video'})
                );
                $.ajax({
                    url: '{{ (api_url~'/api.php?app=extract')|raw }}',
                    dataType: 'json',
                    data: {filename: data}
                }).done(function (result) {
                    console.log(result.filename);
                    $('#results').append('<br>').append(
                        $('<a>',
                            {href: '{{ path('download', {'base': 'ddl', 'filename': ''}) }}'+result.filename, text: 'only audio'})
                    );
                    toastr.success('Done');
                })
                ;
            }).fail(function (xhr, textStatus, errorThrown) {
                toastr.error('Fail');
            })
            ;
            {% endif %}
        })
    </script>
{% endblock javascripts %}